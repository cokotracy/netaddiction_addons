from ..base import supplier
from ..base.adapter import Adapter
from ..base.downloaders import HTTPDownloader
from ..base.parsers import CSVParser


# TODO: Spegnere importazione e prodotti attivi


class Adl(supplier.Supplier):
    files = [
        {
            'name': 'Main',
            'mapping': {
                'http://www.adl.it/?lang=it&section=getlistino&dealer=d00859972586b32ce5610b93c5d83455': (
                    'id_categoria',
                    'id_sottocategoria',
                    'nome_categoria',
                    'nome_sottocategoria',
                    'codice_prodotto',
                    'codice_vendor',
                    'nome_prodotto',
                    'produttore',
                    'prezzo_listino',
                    'prezzo_cessione',
                    'prezzo_promo',
                    'fine_promo',
                    'iva',
                    'disponibilita_attuale',
                    'disponibilita_futura',
                    'data_disponibilita_futura',
                    'url_immagine_full',
                    'url_immagine_low',
                    'descrizione',
                    'caratteristiche',
                    'dotazione',
                    'codice_ean',
                    'codice_mw',
                    'piattaforma',
                    'url_immagine_100',
                    'url_immagine_250',
                    'importo_siae',
                    'tipo_importo_siae',
                    'altezza',
                    'larghezza',
                    'profondita',
                    'peso',
                ),
            },
        },
    ]

    downloader = HTTPDownloader()

    parser = CSVParser(
        skip_first=True,
        delimiter='\t')

    mapping = Adapter(
        barcode='codice_ean',
        supplier_code='codice_vendor',
        supplier_quantity='disponibilita_attuale',
        name='nome_prodotto',
        description='descrizione',
        image='url_immagine_250',
        date=lambda self, item: item['data_disponibilita_futura'] if item['data_disponibilita_futura'] else None)

    CATEGORIES = (
        '500|1000', '500|1004', '500|1008', '500|1009', '500|1012', '500|1021', '500|1024', '500|1025', '500|1031',
        '500|1039', '500|1040', '500|1042', '500|1049', '500|1057', '500|1058', '500|1059', '500|1060', '500|1061',
        '500|1090', '500|1101', '500|1120', '500|1185', '500|1186', '500|1187', '500|1190', '500|1223', '500|1232',
        '500|1234', '500|1235', '500|1248', '500|1256', '500|1260', '500|1264', '500|1265', '500|399', '500|414',
        '500|630', '500|632', '500|634', '500|636', '500|637', '500|743', '500|753', '500|755', '500|786', '500|797',
        '500|850', '500|859', '500|877', '500|904', '500|905', '500|914', '500|920', '500|941', '500|942', '500|943',
        '500|944', '500|949', '500|959', '500|960', '500|961', '500|963', '500|964', '500|973', '500|974', '500|976',
        '500|977', '500|980', '500|985', '500|986', '500|987', '500|988', '500|994', '500|995', '500|996', '501|1002',
        '501|1012', '501|1014', '501|1021', '501|1042', '501|1058', '501|1103', '501|1104', '501|1119', '501|1187',
        '501|1249', '501|295', '501|962', '502|1043', '502|1127', '502|1187', '502|1188', '502|253', '502|319',
        '502|499', '502|739', '502|792', '502|897', '502|95', '502|989', '503|1030', '503|1120', '503|1185',
        '503|1188', '503|1190', '503|1191', '503|1211', '503|1222', '503|1263', '503|80', '503|815', '503|848',
        '503|963', '503|985', '503|988', '504|1037', '504|1050', '504|1084', '504|1101', '504|1187', '504|1188',
        '504|1212', '504|660', '504|739', '504|931', '505|1043', '505|1185', '505|80', '505|896', '505|932', '505|988',
        '520|1002', '520|1011', '520|1016', '520|1051', '520|1088', '520|1121', '520|1122', '520|1257', '520|1269',
        '520|1273', '520|670', '520|798', '520|809', '520|880', '520|882', '520|884', '520|885', '520|895', '520|982',
        '521|1043', '521|130', '521|314', '521|422', '521|469', '521|539', '521|660', '521|69', '521|83', '521|852',
        '521|856', '521|895', '521|896', '521|91', '521|978', '522|130', '522|568', '522|94', '523|576', '523|711',
        '523|856', '523|857', '525|489', '525|856', '525|94', '526|1127', '526|1193', '526|1200', '526|1201',
        '526|1203', '526|1204', '526|1205', '526|1206', '526|1207', '526|1208', '526|1209', '526|1218', '526|1219',
        '526|645', '527|485', '527|856', '527|908', '540|1109', '540|111', '540|1111', '540|1216', '540|165',
        '540|245', '540|405', '540|486', '540|758', '540|761', '540|762', '540|763', '560|1013', '560|1023',
        '560|1105', '560|1107', '560|241', '560|658', '560|761', '560|787', '560|813', '560|814', '560|839',
        '560|849', '560|856', '560|916', '561|1017', '561|1052', '561|1053', '561|1105', '561|1107', '561|1108',
        '561|1185', '561|1239', '561|1276', '561|242', '561|487', '561|622', '561|656', '561|658', '561|787',
        '561|813', '561|857', '561|928', '580|233', '580|518', '580|519', '580|520', '580|521', '580|608', '580|773',
        '580|829', '600|1022', '600|1041', '600|1056', '600|1110', '600|1221', '600|365', '600|405', '600|418',
        '600|542', '600|569', '600|739', '600|772', '600|923', '601|1022', '601|1029', '601|1048', '601|1054',
        '601|1221', '601|1239', '601|1250', '601|301', '601|772', '601|820', '601|821', '601|856', '601|879',
        '601|933', '601|934', '601|935', '601|950', '601|956', '601|975', '620|160', '620|17', '620|284', '620|44',
        '640|1236', '640|1275', '640|351', '641|1114', '641|1251', '641|1259', '641|847', '641|874', '642|1126',
        '642|1135', '642|1151', '642|1152', '642|1153', '642|1154', '642|1155', '642|1157', '642|1159', '642|1161',
        '642|1165', '642|1167', '642|1170', '642|1173', '642|1275', '642|281', '642|426', '642|448', '642|452',
        '642|627', '643|1124', '643|1125', '643|1151', '643|1153', '643|1155', '643|1157', '643|1159', '643|1173',
        '643|281', '643|290', '643|426', '643|607', '660|1076', '660|1077', '660|1078', '660|1225', '660|1226',
        '660|432', '660|979', '680|1032', '680|1033', '680|1034', '680|1035', '680|1095', '680|1096', '680|1097',
        '680|1098', '680|1099', '680|1100', '680|484', '680|638', '680|661', '680|774', '680|775', '680|776',
        '680|777', '680|778', '680|780', '680|846', '700|1067', '700|1080', '700|1081', '701|1074', '701|254',
        '701|383', '703|1065', '703|1066', '703|1067', '703|1068', '703|1071', '703|1079', '703|1082', '703|1083',
        '703|714', '703|922', '704|1071', '704|1072', '704|1074', '704|1087', '704|121', '704|24', '704|7', '706|19',
        '706|756', '706|946', '707|1072', '707|1087', '707|121', '707|24', '707|6', '707|7', '707|757', '708|1068',
        '708|1071', '708|1080', '708|186', '708|187', '708|24', '708|265', '708|6', '708|616', '720|1113', '720|1210',
        '720|1266', '720|1270', '720|654', '720|674', '720|677', '720|725', '720|966', '720|968', '720|984', '720|992',
        '720|993', '720|997', '721|1243', '721|525', '721|724', '722|1174', '722|1252', '722|807', '723|744',
        '724|788', '724|811', '740|1062', '740|1063', '740|1064', '740|1115', '740|1117', '740|1118', '740|7',
        '741|1063', '741|1116', '760|1230', '761|1228', '761|1229', '761|762', '761|853', '761|94', '762|1231',
        '763|824', '707|6', '708|1080', '707|7', '660|1227', '707|24', '504|1291', '708|1071', '503|1283', '500|1286',
        '708|187', '500|1069', '701|1074', '740|7', '620|13', '580|1289', '703|1279', '680|139', '520|889', '500|918',
        '642|627', '708|265', '500|859', '527|1280', '642|449', '642|1157', '501|1271', '720|1019', '704|1087',
        '707|757', '521|958', '601|925', '720|872', '500|1271', '561|841', '704|24', '640|1236', '704|1073', '642|626',
        '723|924', '600|951', '701|118', '720|1292', '707|1072', '704|1072', '701|1290', '504|1288', '720|937',
        '643|1124', '500|990', '641|874', '642|1124', '642|451', '707|1087', '642|1126', '500|915', '500|1287',
        '703|1071', '641|1284', '642|1153', '721|1243', '601|936', '723|1199', '501|1045', '720|891', '720|878',
        '505|976', '640|1282', '643|426', '620|17', '703|1079', '642|294', '704|1074', '520|1020', '740|1064',
        '500|640', '703|922', '660|1077', '660|1078', '561|927', '561|361', '642|1125', '640|1296', '503|815',
        '640|1139', '708|1068', '708|6', '704|7', '500|931', '600|1194', '708|24', '720|1293', '520|430', '503|945',
        '740|1116', '500|1233', '520|568', '708|5', '642|426', '642|1135', '680|709', '720|863', '560|840', '620|1145',
        '601|1048', '600|564', '520|799', '520|953', '704|1071', '720|1294', '642|1155', '642|1131', '660|140',
        '540|213', '642|448', '642|924', '620|1144', '720|869', '640|746', '501|1185', '740|1062', '641|1237',
        '500|1341', '720|571', '520|1047', '500|1310', '500|1319', '502|931', '500|1001', '741|1112', '561|319',
        '680|639', '501|430', '501|1326', '501|1322', '560|623', '521|912', '501|1321', '520|715', '503|851',
        '520|962', '720|1302', '500|567', '501|1046', '501|1325', '501|1308', '503|1304', '500|1323', '503|1278',
        '561|621', '500|319', '500|1336', '501|990', '501|1036', '500|1331', '561|716', '521|1140', '641|1353',
        '500|1309', '526|1283', '503|1350', '722|1277', '500|955', '520|1347', '503|1313', '540|759', '503|1324',
        '521|1283', '500|1327', '500|742', '503|1310', '500|1322', '504|743', '720|1340', '500|1328', '501|1336',
        '500|1330', '505|328', '720|911', '723|1348', '500|1332', '500|1352', '503|1102', '502|851', '520|901',
        '503|1349', '601|1028', '505|851', '504|1299', '500|1329', '501|1323', '505|848', '500|1326', '561|1274',
        '501|739', '500|1320', '502|976', '502|1105', '526|123', '600|1267', '500|1333', '521|924', '500|970',
        '500|1312', '500|1321', '520|883', '561|1295', '720|1345', '521|1150', '500|1355', '500|1007', '520|1311',
        '720|1344', '500|972', '560|838', '600|879', '504|1040', '720|1303', '540|938', '500|834', '505|539',
        '721|1138', '503|319', '642|1283', '502|1305', '500|921', '500|1307', '501|1351', '601|1056', '500|1343',
        '520|1318', '500|1346', '500|1354', '560|1010', '500|926', '720|767', '500|833', '680|748', '500|1357',
        '502|1003', '521|1136', '503|1334', '520|1358', '620|12', '501|1359', '501|1342', '500|659', '520|1362',
        '500|1371', '500|1369', '720|870', '503|980', '500|1384', '501|1309', '500|1382', '501|1366', '642|1158',
        '500|1370', '560|622', '561|1398', '740|1378', '540|916', '701|1071', '520|1363', '521|568', '501|1371',
        '500|1389', '521|253', '561|1399', '501|1312', '561|623', '500|1387', '501|970', '707|1394', '520|1391',
        '724|1253', '740|1375', '740|1401', '740|1397', '500|1360', '503|1365', '560|770', '640|304', '741|1117',
        '720|1383', '505|1364', '763|1356', '520|1361', '503|1335', '501|1341', '560|1393', '706|1395', '540|1093',
        '560|621', '704|1400', '502|1364', '740|1377',
    )

    def validate(self, item):
        subcategory = '%s|%s' % (item['id_categoria'], item['id_sottocategoria'])

        assert subcategory in self.CATEGORIES or item['id_categoria'] in self.CATEGORIES
        assert item['codice_ean'].strip() != ''
        assert item['iva'].strip() != ''
        assert item['prezzo_listino'].strip() != ''
