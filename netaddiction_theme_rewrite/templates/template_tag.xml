<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="template_tag" t-attf-name="Tag | Multiplayer.com">
        <t t-call="website.layout">
            <div>
				<t t-if="tag_name">
					<div class="container nopadding" style="background-color: #f5f5f5;">
						<div class="row nopadding">
							<div class="img_category">
								<!-- <t t-if="category.image_512">
									<t t-if="not '/page/' in current_url">
										<img class="w-100" t-attf-src="data:image/jpeg;base64,{{category.image_512}}" />
									</t>
								</t> -->
							</div>
							<div class="col-sm nopadding text-center">
								<h1 class="d-inline py-3 d-block" t-esc="tag_name"></h1>
								<!-- <t t-if="not '/page/' in current_url">
									<t t-if="category.description">
										<p class="pb-3" t-esc="category.description"></p>
									</t>
								</t> -->
							</div>
						</div>
					</div>
				</t>
			</div>
            <br/>
            <t t-call="netaddiction_theme_rewrite.pagination"/>
            <div class="d-flex container">
				<div id="products_grid_before" class="d-none d-lg-block w-100 te_product_sticky_sidebar te_product_sidebar_scrollbar sticky-media mCustomScrollbar _mCS_1" style="position: sticky; top:110px; height: 781px; max-width:300px;">
					<div id="mCSB_1" class="mCustomScrollBox mCS-dark-thin mCSB_vertical mCSB_inside" style="max-height: none; overflow:auto;" tabindex="0">
						<div id="mCSB_1_container" class="mCSB_container" style="position: relative; top: 0px; left: 0px;" dir="ltr">
							<div class="collapse d-lg-block border-0" id="wsale_products_categories_collapse">
								<strong class="d-block">
									Filtra per:
								</strong>
								<hr class="my-2" />
								<div class="border-bottom">
									<a class="d-block px-3 mb-2 text-primary position-relative" data-toggle="collapse" href="#collapse_status" role="button" aria-expanded="true" aria-controls="collapseExample">
										Stato
										<i class="fa fa-sort-desc position-absolute" style="right:10px; top:50%; transform:translateY(-50%) !important">
										</i>
									</a>
									<div class="collapse show" id="collapse_status" style="max-height:400px; overflow:auto;">
										<div class="card card-body pb-0" id="status_filter_list">
											<div class="d-flex mb-2">
												<input style="margin-top:5px;" type="checkbox" id="status_stock" value="stock" />
												<label class="ml-1" for="status_1">
													Disponibile
												</label>
											</div>
											<div class="d-flex mb-2">
												<input style="margin-top:5px;" type="checkbox" id="status_preorder" value="preorder" />
												<label class="ml-1" for="status_2">
													Prenotazione
												</label>
											</div>
											<div class="d-flex mb-2">
												<input style="margin-top:5px;" type="checkbox" id="status_new" value="new" />
												<label class="ml-1" for="status_3">
													Novit√†
												</label>
											</div>
										</div>
									</div>
								</div>
								<button onclick="checkFilter()" class="btn btn-primary btn-md a-submit d-block d-sm-inline-block te_theme_button w-100">
									Filtra
								</button>
							</div>
							<ul class="list-unstyled mt-3">
								<t t-set="custom_category" t-value="request.env['product.public.category'].sudo().search([('parent_id','=',1)])" />
								<t t-foreach="custom_category" t-as="cat">
									<li class="p-2 border-top">
										<a class="text-secondary" t-attf-href="/shop/category/{{slug(cat)}}">
											<small class="font-weight-bold" t-esc="cat.name">
											</small>
										</a>
									</li>
								</t>
							</ul>
							<script type="text/javascript">
								document.addEventListener("DOMContentLoaded", function() {
								var urlParams = new URLSearchParams(window.location.search);
								var myParam = urlParams.get('status-filter');
								if(myParam != null){
								var selected = myParam.split(',')
								selected.forEach(element =>{
								document.querySelector('#status_' + element).checked = true;
								});
								}
								});
								
								
								function checkFilter(){
								var url = new URL(window.location.href);
								
								var status_filter = ''
								var status_list = document.querySelectorAll('#status_filter_list > div > input:checked');
								status_list.forEach(element =>{
								status_filter += element.value + ','
								});
								url.searchParams.delete('status-filter')
								if(status_filter != ''){
								status_filter = status_filter.slice(0, -1);
								url.searchParams.append('status-filter', status_filter);
								}
								
								
								var tag_filter = ''
								var tag_list = document.querySelectorAll('#collapse_tag > div input:checked');
								tag_list.forEach(element =>{
								tag_filter += element.value + ','
								});
								
								url.searchParams.delete('tag-filter')
								if(tag_filter != ''){
								tag_filter = tag_filter.slice(0, -1);
								url.searchParams.append('tag-filter', tag_filter);
								}
								
								window.location.href = url;
								}
							</script>
						</div>
					</div>
				</div>
                <section class="container">
                    <t t-set="products_ids" t-value="''" />
                    <t t-foreach="product_list_id" t-as="product">
                        <t t-set="products_ids" t-value="products_ids + str(product['id']) + ','" />
                    </t>
                    <t t-set="products_ids" t-value="products_ids[:-1]"/>
                    <section class="pt8 pb8 o_colored_level tag_product_list" data-snippet="p_slider" data-name="Product Snippet Builder">
                        <div class="js_slider_snippet" name="manual-configuration" data-isemipro="true" data-name="manual-configuration" t-attf-data-item_ids="{{products_ids}}" data-style="7" data-ui_option="shopping_cart,wishlist,quick_view,sale_label,ratings" data-slider_type="slider" t-attf-data-limit="{{str(page_size)}}"/>
                    </section>
                </section>
            </div>
            <t t-call="netaddiction_theme_rewrite.pagination"/>
        </t>
    </template>

    <!-- PAGINAZIONE -->
    <template id="pagination">
		<div class="container d-flex custom_pager products_pager form-inline mt-3 mb-3 te_shop_pager">
			<ul class="pagination m-0 ">
				<t t-set="status_filter" t-value="request.params.get('status-filter')"/>
				<t t-set="active_prev" t-value="" />
				<t t-if="current_page == 0">
					<t t-set="active_prev" t-value="'disabled'" />
				</t>
				<li t-attf-class="page-item {{active_prev}}">
					<t t-if="status_filter">
						<t t-set="link_prev" t-value="'/tag/' + tag_name + '?status-filter=' + status_filter" />
					</t>
					<t t-else="">
						<t t-set="link_prev" t-value="'/tag/' + tag_name" />
					</t>
					<t t-if="current_page > 1">
						<t t-if="status_filter">
							<t t-set="link_prev" t-value="link_prev + '?page=' + str(current_page) + '&amp;&amp;status-filter=' + status_filter" />
						</t>
						<t t-else="">
							<t t-set="link_prev" t-value="link_prev + '?page=' + str(current_page)" />
						</t>
					</t>
					<a data-oe-model="ir.ui.view" data-oe-id="1332" data-oe-field="arch" data-oe-xpath="/t[1]/ul[1]/li[1]/a[1]" t-attf-href="{{link_prev}}" class="page-link ">
						Prev
					</a>
				</li>
				<t t-set="button_index" t-value="0" />
				
				<t t-foreach="range(current_page, page_number)" t-as="row_index">
					<t t-if="button_index &lt; 5">
						<t t-set="button_index" t-value="(button_index + 1)" />
						<t t-set="active_link" t-value="" />
						<t t-if="current_page == row_index">
							<t t-set="active_link" t-value="'active'" />
						</t>
						<li t-attf-class="page-item {{active_link}}">
							<t t-if="row_index == 0">
								<t t-if="status_filter">
									<a t-attf-href="/tag/#{tag_name}?status-filter={{status_filter}}" class="page-link" t-esc="(row_index + 1)"></a>
								</t>
								<t t-else="">
									<a t-attf-href="/tag/#{tag_name}" class="page-link" t-esc="(row_index + 1)"></a>
								</t>
							</t>
							<t t-else="">
								<t t-if="status_filter">
									<a t-attf-href="/tag/#{tag_name}?page=#{(row_index + 1)}&amp;&amp;status-filter={{status_filter}}" class="page-link" t-esc="(row_index + 1)"></a>
								</t>
								<t t-else="">
									<a t-attf-href="/tag/#{tag_name}?page=#{(row_index + 1)}" class="page-link" t-esc="(row_index + 1)"></a>
								</t>
							</t>
						</li>
					</t>
				</t>
				<t t-set="active_next" t-value="" />
				<t t-if="(current_page + 1) == page_number">
					<t t-set="active_next" t-value="'disabled'" />
				</t>
				<li t-attf-class="page-item {{active_next}}">
					<t t-set="link_next" t-value="" />
					<t t-if="current_page &lt; page_number">
						<t t-if="status_filter">
							<t t-set="link_next" t-value="'/tag/' + tag_name + '?page=' + str(current_page + 2) + '&amp;&amp;status-filter=' + status_filter" />
						</t>
						<t t-else="">
							<t t-set="link_next" t-value="'/tag/' + tag_name + '?page=' + str(current_page + 2)" />
						</t>
					</t>
					<a data-oe-model="ir.ui.view" data-oe-id="1332" data-oe-field="arch" data-oe-xpath="/t[1]/ul[1]/li[2]/a[1]" t-attf-href="{{link_next}}" class="page-link ">
						Next
					</a>
				</li>
			</ul>
		</div>
	</template>
</odoo>
