<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="theme_assets_frontend_custom" inherit_id="website.assets_frontend">
        <xpath expr="." position="inside" priority="50">
            <!-- AGGIUNGE IN HEAD IN TUTTO IL SITO --> 
            <link href="/netaddiction_theme_rewrite/static/src/css/global.css" rel="stylesheet"/>
                
            <!-- AGGIUNGE IN HEAD PER LA HOME --> 
            <t t-if="(request.env['ir.config_parameter'].sudo().get_param('web.base.url') + '/') == request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/home.css" rel="stylesheet"/>
            </t>
            
            <!-- AGGIUNGE IN HEAD PER LE CATEGORIE -->
            <t t-if="'/shop/category/' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/category.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER I TAG --> 
            <t t-if="'/tag/' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/tag.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER I TERMINI DI SPEDIZIONE -->
            <t t-if="'/costi-metodi-spedizione/' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/shipping.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER LE RICERCHE -->
            <t t-if="'/shop?search=' in request.httprequest.url">
                <meta name="robots" content="noindex, nofollow" />
                <link href="/netaddiction_theme_rewrite/static/src/css/search.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER I PRODOTTI --> 
            <t t-if="'/shop' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/category.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER IL WALLET --> 
            <t t-if="'/wallet' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/wallet.css" rel="stylesheet"/>
            </t>

            <!-- AGGIUNGE IN HEAD PER I PRODOTTI --> 
            <t t-if="'/shop/' in request.httprequest.url">
                <link href="/netaddiction_theme_rewrite/static/src/css/product.css" rel="stylesheet"/>
                    <!-- AGGIUNGE LO SNIPPET PER PRODOTTI -->
                <t t-call="netaddiction_theme_rewrite.product_snippet"/>

                <t t-if="product_variant">
                    <t t-set="product_images" t-value="product_variant._get_images() if product_variant else product._get_images()"/>
                    <t t-set="img_index" t-value="0"/>
                    <t t-foreach="product_images" t-as="img" >
                        <t t-set="img_index" t-value="img_index + 1" />
                        <t t-if="img._name == 'product.image'">
                            <link rel="preload" href="base_url + '/web/image/product.image/' + str(img.id) + '/image_1024/' + str(img.name.replace(' ','%20'))" />
                        </t>
                        <t t-else="">
                            <link rel="preload" href="base_url + '/web/image/product.product/' + str(img.id) + '/image_1024/' + str(img.name.replace(' ','%20'))" />
                        </t>
                    </t>
                </t>
            </t>
        </xpath>
    </template>
    <template id="netaddiction_theme_rewrite_canonical" inherit_id="portal.frontend_layout">
        <xpath expr="//link[@rel='canonical']" position="replace">
            <t t-set="canonical_find" t-value="false"/>
            <t t-if="'/shop/' in request.httprequest.url">
                <t t-call="netaddiction_theme_rewrite.product_snippet"/>
            </t>

            <!--SOSTITUISCE IL CANONICAL-->
            <t t-if="'/shop/category/' in request.httprequest.url">
                <!--CATEGORIE: RIMUOVE LA PAGINAZIONE-->
                <link rel="canonical" t-att-href="website._get_canonical_url(canonical_params=canonical_params).split('/page/')[0]"/>
                <t t-set="canonical_find" t-value="true"/>
            </t>
            <t t-if="'/shop/page/' in request.httprequest.url">
                <!--SHOP PAGE: RIMUOVE LA PAGINAZIONE-->
                <link rel="canonical" t-att-href="website._get_canonical_url(canonical_params=canonical_params).split('/page/')[0]"/>
                <t t-set="canonical_find" t-value="true"/>
            </t>
            <t t-if="'&amp;search=' in request.httprequest.url">
                <!--RICERCA: RIMUOVE LA PAGINAZIONE-->
                <t t-if="'/page/' in request.httprequest.url">
                    <t t-set="split_url" t-value="request.httprequest.url.split('/page/')" />
                    <t t-set="split_pagination" t-value="split_url[1].split('?')" />
                    <link rel="canonical" t-attf-href="{{split_url[0]}}?{{split_pagination[1]}}" />
                </t>
                <t t-else="">
                    <link rel="canonical" t-attf-href="{{request.httprequest.url}}" />
                </t>
                <t t-set="canonical_find" t-value="true"/>
            </t>
            <t t-if="canonical_find == false">
                <!--GLOBALE-->
                <link rel="canonical" t-attf-href="{{request.httprequest.url}}" />
            </t>
        </xpath>
    </template>
    
</odoo>