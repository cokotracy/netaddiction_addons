<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="0">

        <record id="netaddiction_cc_project_issue_form_view" model="ir.ui.view">
            <field name="name">netaddiction.cc.project.issue.form.view</field>
            <field name="model">project.issue</field>
            <field name="priority" eval="30"/>
            <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
            <field name="arch" type="xml">
                <field name="stage_id" position="before">
                    <button name="ticket_working" type="workflow"
                                string="Elabora"
                                states="draft"/>
                    <button name="ticket_close" type="workflow"
                                string="Chiudi" states="working"
                                class="oe_highlight"/>
                        
                    <button string="Chiudi" name="action_reclose" type="object" class="oe_highlight" 
                        attrs="{'invisible': [('state','!=','reopen')]}"/>      
                    <button string="Riapri" name="action_reopen" type="object" class="oe_highlight" 
                        attrs="{'invisible': [('state','!=','close')]}"/>   
                    <field name="state" widget="statusbar"/>
                </field>

                <field name="priority" position="replace">
                    <field name="priority" widget="select"/>
                </field>

                <field name="partner_id" position="replace">
                    <field name="partner_id" domain="[('parent_id','=',False),('customer','=',True)]"/>
                </field>

                <field name="email_from" position="after">
                    <field name="close_immediately" attrs="{'invisible':[('id','!=',False)]}"/>
                </field>

                <field name="user_id" position="before">
                    <field name="company_id"/>
                    <field name="issue_type_src" widget="selection"/>
                </field>

                <field name="stage_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>

                <field name="partner_id" position="before">
                    <field name="satisfaction_rate" string="Tasso di soddisfazione" readonly="True"/>
                    <field name="order_id"/>
                </field>
                <field name="kanban_state" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="project_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="task_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>

                <field name="message_follower_ids" position="replace"/>
                <field name="message_ids" position="replace"/>

                <field name="description" position="attributes">
                    <attribute name="placeholder">Questa è la descrizione del problema che verrà inviata al cliente</attribute>
                </field>

                <field name="description" position="replace">
                    <br/>
                    <field name="description" widget="html" />
                </field>

                <field name="description" position="after">
                    <br/>
                    <field name="message_follower_ids" widget="mail_followers" attrs="{'invisible':1}"/>
                    <field name="message_ids" widget="mail_thread"  attrs="{'invisible':['|',('id','=',False),('state','=','draft')]}" />
                    <br/>
                    <b attrs="{'invisible':[('state','!=','draft')]}">PER POTER RISPONDERE IL TICKET DEVE ESSERE NELLO STATO "IN ELABORAZIONE"</b>
                </field>

                <page name="extra_info" position="replace">
                     <page string="Informazioni aggiuntive" name="extra_info" groups="project.group_project_manager,project.group_project_user,netaddiction_customer_care.netaddiction_cc_manager">
                            <group>
                                <group>
                                    <field name="id"/>
                                    <field name="day_open"/>
                                    <field name="day_close"/>
                                    <field name="working_hours_open" widget="float_time"/>
                                    <field name="working_hours_close" widget="float_time"/>
                                    <field name="inactivity_days"/>
                                    <field name="days_since_creation"/>
                                    <field name="legend_blocked" invisible="1"/>
                                    <field name="legend_done" invisible="1"/>
                                    <field name="legend_normal" invisible="1"/>
                                </group>
                            </group>
                        </page>
                </page>
            </field>
        </record>

        <record id="netaddiction_cc_project_issue_tree_view" model="ir.ui.view">
            <field name="name">netaddiction.cc.project.issue.tree.view</field>
            <field name="model">project.issue</field>
            <field name="priority" eval="30"/>
            <field name="inherit_id" ref="project_issue.project_issue_tree_view"/>
            <field name="arch" type="xml">
                <field name="create_date" position="replace"/>
                <field name="partner_id" position="after">
                    <field name="order_id"/>
                    <field name="email_from"/>
                </field>
                <field name="id" position="after">
                    <field name="create_date"/>
                </field>
                <field name="project_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                </field>
                <field name="stage_id" position="replace">
                    <field name="state" string="Stato"/>
                </field>

                <tree position="attributes">
                    <attribute name="decoration-bf">state == 'draft'</attribute>
                    <attribute name="decoration-danger">state == 'working'</attribute>
                    <attribute name="decoration-muted">state == 'close'</attribute>
                    <attribute name="decoration-warning">state == 'reopen'</attribute>
                </tree>
            </field>
        </record>

        <!--vista albero utente cc-->
        <record id="netaddiction_cc_project_feature_tree_view" model="ir.ui.view">
            <field name="name">netaddiction.cc.project.issue.feature.tree.view</field>
            <field name="model">project.issue</field>
            <field name="priority" eval="30"/>
            <field name="inherit_id" ref="project_issue.project_feature_tree_view"/>
            <field name="arch" type="xml">
                <tree position="replace">
                    <tree string="Feature Tracker Tree" decoration-muted="state == 'close'"
                        decoration-danger="state == 'working'" decoration-bf="state == 'draft'">
                        <field name="id"/>
                        <field name="unread_messages" string="Msg"/>
                        <field name="issue_type_src"/>
                        <field name="create_date"/>
                        <field name="message_needaction" invisible="1"/>
                        <field name="name" string="Oggetto"/>
                        <field name="partner_id"/>
                        <field name="order_id"/>
                        <field name="email_from"/>
                        <field name="priority" string="Priorità"/>
                        <field name="user_id"/>
                        <field name="state" string="Stato" widget="selection" readonly="1"/>
                        <field name="company_id"/>
                        
                        <field name="date_open"/>
                        <field name="date_closed"/>
                    </tree>
                </tree>

            </field>
        </record>

         <record id="netaddiction_cc_project_feature_search_view" model="ir.ui.view">
            <field name="name">netaddiction.cc.project.issue.feature.search.view</field>
            <field name="model">project.issue</field>
            <field name="priority" eval="30"/>
            <field name="inherit_id" ref="project_issue.view_project_issue_filter"/>
            <field name="arch" type="xml">
                <search position="replace">
                    <search string="Issue Tracker Search">
                        <field name="name" string="Problematica" filter_domain="['|', '|','|', '|',('id','=',self), ('partner_id','child_of',self),('email_from','ilike',self),('name','ilike',self),('order_id','ilike',self)]"/>
                        <field name="id" string="Ticket ID"/>
                        <field name="partner_id" operator="child_of"/>
                        <field name="user_id"/>
                        <field name="order_id"/>
                        <field name="tag_ids"/>

                        <filter string="Le mie Problematiche" domain="[('user_id','=',uid)]"/>
                        <filter string="Non Assegnate" name="unassigned" domain="[('user_id', '=', False)]"/>
                        <separator/>
                        <filter string="Nuovi" name="draft" domain="[('state', '=', 'draft')]"/>
                        <filter string="In Elaborazione" name="working" domain="[('state', '=', 'working')]"/>
                         <filter string="Riaperti" name="reopen" domain="[('state', '=', 'reopen')]"/>
                        <filter string="Chiusi" name="close" domain="[('state', '=', 'close')]"/>
                        <separator/>
                        <filter string="Telefonici" name="phone" domain="[('issue_type_src', '=', 'phone')]"/>
                        <filter string="Manuali" name="manual" domain="[('issue_type_src', '=', 'manual')]"/>
                        <filter string="E-mail" name="email" domain="[('issue_type_src', '=', 'email')]"/>
                        <filter string="Ebay" name="ebay" domain="[('issue_type_src', '=', 'ebay')]"/>
                        <filter string="Facebook" name="fb" domain="[('issue_type_src', '=', 'fb')]"/>
                        <separator/>
                        <filter string="Messaggi non letti" name="msgs" domain="[('unread_messages', '!=', 0)]"/>
                    </search>
                </search>

            </field>
        </record>

        
    </data>
</openerp>
