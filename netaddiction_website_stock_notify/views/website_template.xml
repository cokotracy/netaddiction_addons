<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="assets_frontend" inherit_id="website_sale.assets_frontend">
        <xpath expr="script[last()]" position="after">
            <script type="text/javascript" src="/netaddiction_website_stock_notify/static/src/js/website_sale_notify.js"></script>
        </xpath>
    </template>

    <template id="netaddiction_website_stock_notify_button" name='stock product notification' inherit_id="website_sale.product" priority="8">
        <xpath expr="//a[@id='add_to_cart']" position="after">

            <t t-set="current" t-value="datetime.datetime.now()"/>
            <t t-if="product.out_date">
                <t t-set="out_date" t-value="datetime.datetime.strptime(str(product.out_date) + ' 00:00:00.00000', '%Y-%m-%d %H:%M:%S.%f')"/>
            </t>

            <t t-if="product.sale_ok == False or product.sudo().product_variant_id.qty_sum_suppliers &lt;= 0 and product.product_variant_id.qty_available_now &lt;= 0">
                <t t-if="not out_date or out_date &lt; current or product.sale_ok == False">
                    <div class="o_product_notify">
                        <small class="text-primary mt-2">Avvisami quando Ã¨ disponibile:</small>
                        <div t-attf-class="mb-3 input-group #{_classes}">
                            <input class="col-auto col-md-6 form-control d-block" type="email" id="email" placeholder="Inserisci la tua email" t-att-value="user_id.email" />
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-primary submit-notify">
                                    <i class="fa fa-envelope"></i> Avvisami</button>
                            </div>
                        </div>
                        <div class="o_notify_message alert alert-info d-none" style="margin-top: 10px;"></div>
                        <div class="o_notify_alert_message alert alert-warning d-none" style="margin-top: 10px;"></div>
                    </div>
                </t>
            </t>
        </xpath>
    </template>

</odoo>
